Raspberry Piをradikoラジオにする(らじるも使える)

![sample](https://user-images.githubusercontent.com/49352933/82976092-272b5800-a019-11ea-9ec7-32c22b80a651.jpg)
![pirate](https://user-images.githubusercontent.com/49352933/83227689-bf634180-a1bf-11ea-97cb-83e33b1f1227.jpg)
![pirate_radio_s](https://user-images.githubusercontent.com/49352933/83390979-c1323c80-a42d-11ea-80bc-6600990643d6.jpg)

要るもの:

どこのご家庭にでもある以下のもを使います
1. Raspberri Pi 3とか4とかZero Wとか
2. GPIOに繋ぐスイッチ5個(PUSH ON)
   プルアップ抵抗5個(*)
3. フレームバッファ(/dev/fbX)として使える液晶(このスクリプトでは320x240を想定)
   AdafruitのPiTFT mini(2.8")を使っていますが、タッチパネル対応がじゃまくさいの
   でタッチには対応していません。スイッチ操作だけです。
   そのへんで売ってる安いSPIのTFTでも/dev/fbXとして動作させられれば使えます
4. 日本語表示用の適当なTTFフォント
5. ffmpegを別途インストールしてください。ffplayを使用します。

*:GPIOにスイッチを繋ぐ場合プルアップし、スイッチはピンとGND間に繋ぎます。


ふつう(piradio.py)版

画面にはpygameを使用していますので、pygameで使えるフレームバッファが必要です。
今のところ Python 2.7 用です

Pirate Audio(piradio_pirate.py)版

画面はPILで書いてます。Pirate Audioはフレームバッファとしては動作させませんが
SPI液晶のPythonライブラリが必要になります。Pirate_README.txtを見てください。


Radikoの再生スクリプトはあちこちにありますが、出所が明確ではないものが多いので新
規に書いて、radiko.pyで実装してあります。Radikoプレミアムにも対応しています。エリ
アフリーを使いたい場合にはプレミアムに登録しメールアドレスとパスワードを設定すれ
ば使えます。 プレミアム使用時に頻繁なログインを避けるため cookieの情報をカレント
ディレクトリに持ちますのでスクリプトが書き込めるディレクトリで起動してください。
他の場所にcookieを保存したい場合にはスクリプトを修正してください。

フレームバッファがない場合でもAPI操作のラジオになります。-noguiを付けて起動する
とAPIだけで動きます。が、初期起動時の音量が小さすぎるので vol_val を調整して起動
してください。今のところAPIで音量調整はサポートしていません。


局リストの作り方:

デフォルトのまま使う場合には起動ディレクトリの下に ./stations というディレクトリ
を作り、その 中に station_list という名前でファイルを作成します。
項目は次の通りです

  局の識別子,日本語局名,英数字のみの局名,ロゴ画像ファイル名,再生方式

　例：

　RN1,ラジオ日経第一,RADIO NIKKEI 1,RN1.png,radiko

再生方式は今のところradikoかradiruです。らじるの場合には識別子のところにCDNのURL
を指定します。他の再生方式でもまあ対応できるので対応の方法は中身を見てください。

現在または指定したエリアの局を一括して生成できるpythonスクリプトも同梱しています

python get_stations.py > station_list

と実行すると現在のエリアの局情報を取得し局リストをつくることができます。この時、
各局のロゴファイルも自動的にダウンロードします。
特定エリアの局情報を取得するには

python get_stations.py JP1 

のように実行します。JPxのxは都道府県コードです。

音が出ない場合にはオーディオデバイスの設定を確認してください。FFPlayで使えるデバ
イスが指定されていれば音は出るはずです。


API:

Webブラウザなどから制御可能なように超簡単なAPIも用意してあります。何のセキュリティ
もありませんので家で使う程度にしてください。
piradio_ai_portでAPIが使用するポート番号を指定します。localhost:ポート番号でAPIが
待ち受けます。現在のところRadikoにしか対応していませんが、以下の2種類のメッセージ
を送り付けるだけで再生と停止が行えます。

START:RN1 - Radikoの識別子 RN1 を再生開始します

STOP:     - 現在の再生を停止します。

2020/05/28
若干の問題に対処とPython3対応しました。Python3で動かしたい場合には中の"Python3"を検索して修正箇所をみてください。デフォルトはPython2です。

2020/05/29
Pirate Audio対応版をリリース。詳しくはPirate_README.txtを。

2020/05/30
ちょいと修正など。ALSAのデバイスに対する注記も追加。

2020/06/01
音量調整を変更。32ステップ制御に。volume_profile[]を変更することでカーブを調整できます。

筐体データはここにあります
https://www.thingiverse.com/thing:4417542
